<!DOCTYPE html>
<html>
<head>
    <title>Poetry AI Hub</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #121212; padding: 20px; color: #e0e0e0; }
        .container { max-width: 800px; margin: auto; background: #1e1e1e; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .status-bar { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; padding-bottom: 15px; }
        
        .poem-display { 
            margin-top: 30px; 
            min-height: 400px; 
            display: flex; 
            flex-direction: column; 
            gap: 15px;
        }

        /* Base style for every line */
        .line-wrapper { max-width: 70%; padding: 12px 18px; border-radius: 15px; position: relative; }

        /* Left Alignment (Odd lines: 1, 3, 5...) */
        .line-wrapper.left {
            align-self: flex-start;
            background: #2a2a2a;
            border-bottom-left-radius: 2px;
            text-align: left;
        }

        /* Right Alignment (Even lines: 2, 4, 6...) */
        .line-wrapper.right {
            align-self: flex-end;
            background: #333;
            border-bottom-right-radius: 2px;
            text-align: right;
        }

        .agent-id { font-weight: bold; font-size: 0.75em; text-transform: uppercase; margin-bottom: 4px; display: block; }
        .line-text { font-style: italic; font-size: 1.1em; }

        .controls { margin-top: 30px; display: flex; gap: 10px; justify-content: center; }
        button { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; color: white; font-weight: bold; transition: 0.3s; }
        .btn-start { background: #2ecc71; }
        .btn-end { background: #e74c3c; }
        .btn-reset { background: #555; }
        button:hover { opacity: 0.8; transform: translateY(-2px); }
    </style>
</head>
<body>
    <div class="container">
        <div class="status-bar">
            <h2>Poetry Hub</h2>
            <span id="status-label">● Offline</span>
        </div>
        
        <div id="poem-display" class="poem-display"></div>

        <div class="controls">
            <button class="btn-start" onclick="sendControl('start')">START</button>
            <button class="btn-end" onclick="sendControl('end')">END</button>
            <button class="btn-reset" onclick="sendControl('reset')">RESET</button>
        </div>
    </div>

    <script>
        // Function to generate a consistent color based on the agent's name
        function getAgentColor(name) {
            let hash = 0;
            for (let i = 0; i < name.length; i++) {
                hash = name.charCodeAt(i) + ((hash << 5) - hash);
            }
            const c = (hash & 0x00FFFFFF).toString(16).toUpperCase();
            return "#" + "00000".substring(0, 6 - c.length) + c;
        }

        async function update() {
            try {
                const res = await fetch('/api/hub');
                const data = await res.json();
                
                document.getElementById('status-label').innerText = data.is_running ? "● Active" : "● Paused";
                document.getElementById('status-label').style.color = data.is_running ? "#2ecc71" : "#e74c3c";

                const display = document.getElementById('poem-display');
                
                display.innerHTML = data.poem.map((p, index) => {
                    // Alternate classes: index 0 is left, index 1 is right, etc.
                    const alignmentClass = (index % 2 === 0) ? 'left' : 'right';
                    const agentColor = getAgentColor(p.agent_name);

                    return `
                        <div class="line-wrapper ${alignmentClass}">
                            <span class="agent-id" style="color: ${agentColor}">${p.agent_name}</span>
                            <div class="line-text">${p.line}</div>
                        </div>
                    `;
                }).join('');
                
                // Auto-scroll to the bottom of the poem
                display.scrollTop = display.scrollHeight;

            } catch (e) { console.error("Update failed", e); }
        }

        async function sendControl(action) {
            await fetch(`/api/hub/control?action=${action}`, { method: 'POST' });
            update();
        }

        setInterval(update, 2000);
        update();
    </script>
</body>
</html>
